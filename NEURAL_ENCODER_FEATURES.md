# 神经网络Encoder特性模拟

本文档详细说明了ALQuery3D中新增的神经网络encoder特性模拟功能。

## 概述

基于您对embedding特性的理解，我们重新设计了embedding生成器，使其更好地模拟真实神经网络encoder的特性。新的系统包含以下特性：

## 基础几何属性

### 1. 分散度 (Dispersion)
- **定义**: 控制到类中心距离的缩放因子
- **理解**: 获得类的分布后，到分布中心点的距离乘以分散度来缩放对应点的距离
- **范围**: 0.0-1.0 → 0.1-5.0 (实际缩放因子)
- **效果**: 值越大，类内样本分布越分散

### 2. 曲度 (Curvature)
- **定义**: 控制圆锥体分布程度
- **理解**: 在对应维度空间中形成圆锥体分布的程度
- **范围**: 0.0-1.0 → 0.0-2.0 (圆锥强度)
- **实现**: 距离越远变形越大，在垂直于主轴方向应用圆锥缩放

### 3. 扁平度 (Flatness)
- **定义**: 控制靠近超平面的程度
- **理解**: 在对应空间中分布靠近于某个超平面的程度(针对每个类，超平面可以随机生成)
- **范围**: 0.0-1.0 → 0.0-1.0 (压缩程度)
- **实现**: 计算点到超平面距离，根据扁平度向超平面压缩

### 4. 类间距离 (Inter-class Distance)
- **定义**: 控制类中心间距离缩放
- **理解**: 首先随机出一组类中心点，然后根据类间距离进行缩放
- **范围**: 0.0-1.0 → 0.1-50.0 (实际距离)

### 5. 类内相关性 (Intra-class Correlation)
- **定义**: 高斯分布的sigma值
- **理解**: 控制类内特征的相关程度
- **范围**: 0.0-1.0 → 0.1-3.0 (sigma值)

### 6. 类间超平面平行度 (Inter-hyperplane Parallelism)
- **定义**: 控制类间超平面的平行程度
- **理解**: 生成对应超平面方程后，通过平行度将超平面逐步缩放到平行
- **范围**: 0.0-1.0 → 0.0-0.99 (平行程度)
- **效果**: 当扁平度和平行度都为1时，在空间中看就是两个平行的超平面点云

## 神经网络Encoder特性

### 7. 流形复杂度 (Manifold Complexity)
- **定义**: 控制局部非线性结构
- **理解**: 模拟神经网络中的非线性激活函数效应
- **范围**: 0.0-1.0 → 0.0-2.0 (非线性强度)
- **实现**: 应用二次、正弦、双曲正切等非线性变换

### 8. 特征稀疏性 (Feature Sparsity)
- **定义**: 控制激活维度的稀疏程度
- **理解**: 模拟ReLU等激活函数导致的特征稀疏性
- **范围**: 0.0-1.0 → 0.0-0.9 (稀疏程度)
- **实现**: 随机选择维度置零，模拟神经元不激活

### 9. 噪声水平 (Noise Level)
- **定义**: 模拟编码过程中的信息损失
- **理解**: 神经网络训练和推理过程中的随机性
- **范围**: 0.0-1.0 → 0.0-0.5 (噪声强度)
- **实现**: 添加高斯噪声

### 10. 边界锐度 (Boundary Sharpness)
- **定义**: 控制类别边界的清晰程度
- **理解**: 模拟分类器决策边界的锐利程度
- **范围**: 0.0-1.0 → 0.0-5.0 (锐度系数)
- **实现**: 根据到类中心距离调整分布，高锐度更集中

### 11. 维度各向异性 (Dimensional Anisotropy)
- **定义**: 不同维度的重要性差异
- **理解**: 模拟神经网络中不同特征维度的重要性差异
- **范围**: 0.0-1.0 → 0.0-0.8 (各向异性程度)
- **实现**: 随机选择维度进行不同程度的缩放

## 参数映射系统

所有参数都使用0-1的标准化范围，内部映射到实际使用范围：

```python
# 示例映射
dispersion: 0.0-1.0 → 0.1-5.0
curvature: 0.0-1.0 → 0.0-2.0
flatness: 0.0-1.0 → 0.0-1.0
correlation: 0.0-1.0 → 0.1-3.0
parallelism: 0.0-1.0 → 0.0-0.99
manifold: 0.0-1.0 → 0.0-2.0
sparsity: 0.0-1.0 → 0.0-0.9
noise: 0.0-1.0 → 0.0-0.5
sharpness: 0.0-1.0 → 0.0-5.0
anisotropy: 0.0-1.0 → 0.0-0.8
```

## 应用场景

### 1. 真实神经网络模拟
- 设置适中的流形复杂度(0.2-0.4)
- 添加少量噪声(0.05-0.1)
- 设置特征稀疏性(0.1-0.3)
- 调整边界锐度模拟不同分类器

### 2. 理想化数据生成
- 低噪声水平(0.0-0.05)
- 高边界锐度(0.7-1.0)
- 低流形复杂度(0.0-0.2)

### 3. 挑战性数据生成
- 高噪声水平(0.3-0.5)
- 高流形复杂度(0.6-1.0)
- 高特征稀疏性(0.5-0.9)
- 高维度各向异性(0.6-0.8)

## Web界面使用

新的Web界面提供了所有参数的直观控制：

1. **基础几何属性**: 分散度、曲度、扁平度、类内相关性
2. **全局参数**: 类间距离、类间超平面平行度
3. **神经网络特性**: 流形复杂度、特征稀疏性、噪声水平、边界锐度、维度各向异性

每个参数都有：
- 数值输入框(0.00-1.00)
- 滑动条控制
- 实时同步更新

## 技术实现

### 生成流程
1. 生成基础高斯分布样本(使用sigma作为相关性)
2. 应用分散度缩放(距离缩放因子)
3. 应用曲度变换(圆锥体分布)
4. 应用扁平度变换(靠近超平面)
5. 平移到类别中心
6. 应用流形复杂度变换
7. 应用特征稀疏性变换
8. 应用噪声水平变换
9. 应用边界锐度变换
10. 应用维度各向异性变换
11. 平移到超平面
12. 标准化到-1~1范围

### 超平面生成
- 第一个超平面随机生成
- 后续超平面根据平行度与已有超平面混合
- 支持完全随机(平行度=0)到几乎平行(平行度=1)

## 验证和测试

系统通过了全面测试：
- ✅ 基础功能测试
- ✅ 极端参数值测试
- ✅ 3D embedding特殊处理
- ✅ 多维度支持(3-2048)
- ✅ 参数映射验证
- ✅ 可视化生成

## 总结

新的系统成功实现了您对embedding特性的理解，并添加了更多神经网络encoder特性，提供了：

1. **准确的几何控制**: 分散度、曲度、扁平度按您的理解实现
2. **超平面平行度**: 支持从随机到完全平行的控制
3. **神经网络特性**: 流形复杂度、稀疏性、噪声、边界锐度、各向异性
4. **直观的Web界面**: 所有参数都有直观的控制方式
5. **完整的参数系统**: 0-1标准化范围，内部映射到合适的实际范围

这个系统现在能够更真实地模拟神经网络encoder的各种特性，为embedding分析和可视化提供了强大的工具。 