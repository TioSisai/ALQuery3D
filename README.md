# ALQuery3D
ä¸€ä¸ªçº¯Pythonå®ç°çš„é«˜ç»´embeddingsç”Ÿæˆå™¨ï¼Œä¸“ä¸ºä¸»åŠ¨å­¦ä¹ ç ”ç©¶è®¾è®¡
æä¾›Webç•Œé¢è¿›è¡Œå‚æ•°æ§åˆ¶å’Œ3Då¯è§†åŒ–
åç«¯ä½¿ç”¨numpyã€scipyå’Œscikit-learnç­‰CPU-onlyåº“å®ç°

## é¡¹ç›®ç»“æ„

```
ALQuery3D/
â”œâ”€â”€ src/                          # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ data/                     # æ•°æ®å¤„ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ embedding_generator.py  # é«˜ç»´embeddingsç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ web/                      # Webç•Œé¢
â”‚   â”‚   â”œâ”€â”€ app.py               # Flaskåç«¯
â”‚   â”‚   â””â”€â”€ templates/
â”‚   â”‚       â””â”€â”€ index.html       # Webå‰ç«¯ç•Œé¢
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ data/                         # æ•°æ®ç¼“å­˜ç›®å½•
â”‚   â””â”€â”€ tmp_data.h5              # HDF5ç¼“å­˜æ–‡ä»¶
â”œâ”€â”€ examples/                     # ç¤ºä¾‹ä»£ç 
â”‚   â””â”€â”€ generate_embeddings_demo.py  # embeddingsç”Ÿæˆæ¼”ç¤º
â”œâ”€â”€ tests/                        # æµ‹è¯•ç›®å½•
â”‚   â””â”€â”€ test_embedding_generator.py  # å•å…ƒæµ‹è¯•
â”œâ”€â”€ run_web.py                    # Webåº”ç”¨å¯åŠ¨è„šæœ¬
â”œâ”€â”€ requirements.txt              # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ README.md
â””â”€â”€ LICENSE
```

## æ ¸å¿ƒåŠŸèƒ½

### 1. é«˜ç»´Embeddingsç”Ÿæˆå™¨ (`EmbeddingGenerator`)

æ¨¡æ‹Ÿç¥ç»ç½‘ç»œencoderç”Ÿæˆçš„é«˜ç»´embeddingsï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

- **ç±»åˆ«èšé›†**: ä¸åŒç±»åˆ«çš„æ ·æœ¬å›´ç»•å„è‡ªçš„ä¸­å¿ƒèšé›†
- **å¯æ§åˆ†æ•£åº¦**: æ§åˆ¶ç±»å†…æ ·æœ¬çš„æ•£å¸ƒç¨‹åº¦ (0.1-5.0)
- **å¯æ§æ›²åº¦**: æ§åˆ¶æ•°æ®çš„éçº¿æ€§å˜å½¢ç¨‹åº¦ (0.0-1.0)  
- **å¯æ§æ‰å¹³åº¦**: æ§åˆ¶åœ¨æŸäº›ç»´åº¦ä¸Šçš„å‹ç¼©ç¨‹åº¦ (0.1-1.0)
- **ç±»é—´è·ç¦»æ§åˆ¶**: æ§åˆ¶ä¸åŒç±»åˆ«ä¸­å¿ƒä¹‹é—´çš„è·ç¦»
- **ç±»å†…ç›¸å…³æ€§**: æ§åˆ¶ç±»å†…ç‰¹å¾çš„ç›¸å…³ç¨‹åº¦

### 2. ä¸»è¦åŠŸèƒ½

- âœ… **é«˜ç»´embeddingsç”Ÿæˆ**: æ”¯æŒ3-2048ç»´embeddingsç”Ÿæˆ
- âœ… **Webå¯è§†åŒ–ç•Œé¢**: ç°ä»£åŒ–çš„Webç•Œé¢ï¼Œæ”¯æŒå®æ—¶å‚æ•°è°ƒèŠ‚
- âœ… **å‚æ•°åŒ–æ§åˆ¶**: ç²¾ç¡®æ§åˆ¶æ•°æ®çš„å„ç§å‡ ä½•ç‰¹æ€§
- âœ… **é™ç»´å¯è§†åŒ–**: æ”¯æŒPCAã€t-SNEã€UMAPç­‰é™ç»´æ–¹æ³•è¿›è¡Œ3Då¯è§†åŒ–
- âœ… **æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ**: HDF5ç¼“å­˜æå‡æ€§èƒ½ï¼Œé¿å…é‡å¤è®¡ç®—
- âœ… **æ•°æ®æ ‡å‡†åŒ–**: è‡ªåŠ¨æ ‡å‡†åŒ–åˆ°-1~1èŒƒå›´
- âœ… **çµæ´»çš„API**: æä¾›ä¾¿æ·å‡½æ•°å’Œè¯¦ç»†çš„å‚æ•°æ§åˆ¶

## å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

æˆ–æ‰‹åŠ¨å®‰è£…æ ¸å¿ƒä¾èµ–ï¼š

```bash
pip install numpy scikit-learn matplotlib scipy
```

## å¿«é€Ÿå¼€å§‹

### Webç•Œé¢ä½¿ç”¨

å¯åŠ¨Webåº”ç”¨ï¼š

```bash
python run_web.py
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://localhost:5000`

**Webç•Œé¢åŠŸèƒ½**ï¼š
- ğŸ›ï¸ **å‚æ•°æ§åˆ¶**: ç›´è§‚çš„æ»‘åŠ¨æ¡å’Œè¾“å…¥æ¡†æ§åˆ¶æ‰€æœ‰å‚æ•°
- ğŸ“Š **å®æ—¶å¯è§†åŒ–**: 3Däº¤äº’å¼å›¾è¡¨ï¼Œæ”¯æŒæ—‹è½¬ã€ç¼©æ”¾
- ğŸ”„ **é™ç»´æ–¹æ³•åˆ‡æ¢**: ä¸€é”®åˆ‡æ¢PCAã€t-SNEã€UMAP
- ğŸ’¾ **æ™ºèƒ½ç¼“å­˜**: è‡ªåŠ¨ç¼“å­˜é™ç»´ç»“æœï¼Œæå‡å“åº”é€Ÿåº¦
- ğŸ“ˆ **ç»Ÿè®¡ä¿¡æ¯**: å®æ—¶æ˜¾ç¤ºæ•°æ®ç»Ÿè®¡å’Œç»´åº¦ä¿¡æ¯

### ç¼–ç¨‹æ¥å£ä½¿ç”¨

```python
from src.data.embedding_generator import EmbeddingGenerator

# åˆ›å»ºç”Ÿæˆå™¨
generator = EmbeddingGenerator(embedding_dim=128, random_state=42)

# ç”Ÿæˆembeddingsï¼ˆæ‰€æœ‰å‚æ•°æ ‡å‡†åŒ–åˆ°0-1èŒƒå›´ï¼‰
embeddings, labels = generator.generate_clustered_embeddings(
    n_samples_per_class=[100, 150, 120],  # æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬æ•°
    dispersion=0.6,                       # åˆ†æ•£åº¦ (0.0-1.0)
    curvature=0.2,                        # æ›²åº¦ (0.0-1.0)
    flatness=0.7,                         # æ‰å¹³åº¦ (0.0-1.0)
    inter_class_distance=0.8,             # ç±»é—´è·ç¦» (0.0-1.0)
    intra_class_correlation=0.4           # ç±»å†…ç›¸å…³æ€§ (0.0-1.0)
)

print(f"ç”Ÿæˆçš„embeddingså½¢çŠ¶: {embeddings.shape}")
print(f"ç±»åˆ«æ•°é‡: {len(np.unique(labels))}")
```

### æ¯ç±»åˆ«ç‹¬ç«‹æ§åˆ¶

```python
# ä¸ºæ¯ä¸ªç±»åˆ«è®¾ç½®ä¸åŒçš„å‚æ•°
embeddings, labels = generator.generate_clustered_embeddings(
    n_samples_per_class=[80, 100, 120],
    dispersion=[0.3, 0.6, 0.9],           # æ¯ä¸ªç±»åˆ«ä¸åŒçš„åˆ†æ•£åº¦
    curvature=[0.1, 0.3, 0.5],            # æ¯ä¸ªç±»åˆ«ä¸åŒçš„æ›²åº¦
    flatness=[0.4, 0.7, 1.0],             # æ¯ä¸ªç±»åˆ«ä¸åŒçš„æ‰å¹³åº¦
    inter_class_distance=0.7,             # å…¨å±€ç±»é—´è·ç¦»
    intra_class_correlation=[0.2, 0.5, 0.8]  # æ¯ä¸ªç±»åˆ«ä¸åŒçš„ç›¸å…³æ€§
)
```

### é™ç»´å¯è§†åŒ–

```python
# PCAé™ç»´åˆ°3D
reduced_pca = generator.reduce_dimensions(n_components=3, method='pca')

# t-SNEé™ç»´åˆ°3D  
reduced_tsne = generator.reduce_dimensions(n_components=3, method='tsne')

# UMAPé™ç»´åˆ°3D
reduced_umap = generator.reduce_dimensions(n_components=3, method='umap')

# è·å–é™ç»´ä¿¡æ¯
info = generator.dimensionality_reduction_info
if info['method'] == 'pca':
    print(f"å‰3ä¸ªä¸»æˆåˆ†è§£é‡Šçš„æ–¹å·®æ¯”ä¾‹: {info['explained_variance_ratio']}")
elif info['method'] == 'tsne':
    print(f"t-SNE KLæ•£åº¦: {info['kl_divergence']}")
elif info['method'] == 'umap':
    print(f"UMAPå‚æ•°: {info['parameters']}")
```

### ä¾¿æ·å‡½æ•°

```python
from src.data.embedding_generator import create_sample_dataset

# å¿«é€Ÿåˆ›å»ºç¤ºä¾‹æ•°æ®é›†
embeddings, labels = create_sample_dataset(
    n_classes=5,
    samples_per_class=100,
    embedding_dim=128,
    random_state=42
)
```

## è¿è¡Œæ¼”ç¤º

### Webç•Œé¢æ¼”ç¤º
```bash
# å¯åŠ¨Webåº”ç”¨
python run_web.py
```

### ç¼–ç¨‹æ¥å£æ¼”ç¤º
```bash
# è¿è¡Œå®Œæ•´æ¼”ç¤º
python examples/generate_embeddings_demo.py

# è¿è¡Œå•å…ƒæµ‹è¯•
python tests/test_embedding_generator.py
```

æ¼”ç¤ºå°†å±•ç¤ºï¼š
- åŸºæœ¬embeddingç”Ÿæˆ
- å‚æ•°å¯¹ç»“æœçš„å½±å“
- é™ç»´å’Œå¯è§†åŒ–
- æ•°æ®ä¿å­˜å’ŒåŠ è½½
- ç»Ÿè®¡ä¿¡æ¯è®¡ç®—

## å‚æ•°è¯´æ˜

### `generate_clustered_embeddings` å‚æ•°

| å‚æ•° | ç±»å‹ | èŒƒå›´ | è¯´æ˜ |
|------|------|------|------|
| `n_samples_per_class` | List[int] | 10-5000 | æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬æ•°é‡åˆ—è¡¨ |
| `embedding_dim` | int | 3-2048 | Embeddingç»´åº¦ |
| `dispersion` | float/List[float] | 0.0-1.0 | åˆ†æ•£åº¦ï¼Œæ§åˆ¶ç±»å†…æ ·æœ¬æ•£å¸ƒç¨‹åº¦ |
| `curvature` | float/List[float] | 0.0-1.0 | æ›²åº¦ï¼Œæ§åˆ¶éçº¿æ€§å˜å½¢ç¨‹åº¦ |
| `flatness` | float/List[float] | 0.0-1.0 | æ‰å¹³åº¦ï¼Œæ§åˆ¶ç»´åº¦å‹ç¼©ç¨‹åº¦ |
| `inter_class_distance` | float | 0.0-1.0 | ç±»é—´è·ç¦»ï¼Œæ§åˆ¶ç±»åˆ«ä¸­å¿ƒé—´è·ç¦» |
| `intra_class_correlation` | float/List[float] | 0.0-1.0 | ç±»å†…ç›¸å…³æ€§ï¼Œæ§åˆ¶ç‰¹å¾ç›¸å…³ç¨‹åº¦ |

### ç”Ÿæˆæ•ˆæœ

- **ä½åˆ†æ•£åº¦ (0.2)**: æ ·æœ¬ç´§å¯†èšé›†åœ¨ç±»åˆ«ä¸­å¿ƒå‘¨å›´
- **é«˜åˆ†æ•£åº¦ (0.8)**: æ ·æœ¬åœ¨ç±»åˆ«ä¸­å¿ƒå‘¨å›´å¹¿æ³›åˆ†å¸ƒ
- **ä½æ›²åº¦ (0.0)**: æ•°æ®å‘ˆç°çº¿æ€§é«˜æ–¯åˆ†å¸ƒç‰¹å¾
- **é«˜æ›²åº¦ (0.8)**: æ•°æ®å…·æœ‰å¤æ‚çš„éçº¿æ€§ç»“æ„
- **ä½æ‰å¹³åº¦ (0.2)**: æ•°æ®åœ¨å¤§éƒ¨åˆ†ç»´åº¦ä¸Šè¢«å‹ç¼©
- **é«˜æ‰å¹³åº¦ (1.0)**: æ•°æ®åœ¨å„ç»´åº¦ä¸Šç›¸å¯¹å‡åŒ€åˆ†å¸ƒ
- **ä½ç±»é—´è·ç¦» (0.2)**: ä¸åŒç±»åˆ«ä¸­å¿ƒé è¿‘
- **é«˜ç±»é—´è·ç¦» (0.8)**: ä¸åŒç±»åˆ«ä¸­å¿ƒç›¸è·è¾ƒè¿œ
- **ä½ç›¸å…³æ€§ (0.1)**: ç‰¹å¾ç»´åº¦é—´ç›¸äº’ç‹¬ç«‹
- **é«˜ç›¸å…³æ€§ (0.9)**: ç‰¹å¾ç»´åº¦é—´é«˜åº¦ç›¸å…³

### åˆ†æ•£åº¦ vs ç±»å†…ç›¸å…³æ€§

**åˆ†æ•£åº¦ï¼ˆdispersionï¼‰** å’Œ **ç±»å†…ç›¸å…³æ€§ï¼ˆintra_class_correlationï¼‰** æ§åˆ¶ä¸åŒæ–¹é¢ï¼š

- **åˆ†æ•£åº¦**: æ§åˆ¶æ ·æœ¬å›´ç»•ç±»åˆ«ä¸­å¿ƒçš„æ•´ä½“æ•£å¸ƒ**èŒƒå›´**ï¼ˆæ ‡é‡ç¼©æ”¾æ•ˆåº”ï¼‰
- **ç±»å†…ç›¸å…³æ€§**: æ§åˆ¶ç‰¹å¾ç»´åº¦ä¹‹é—´çš„**ç›¸å…³ç»“æ„**ï¼ˆåæ–¹å·®çŸ©é˜µæ•ˆåº”ï¼‰

ä¸¤è€…ç›¸äº’è¡¥å……ï¼Œå…±åŒå†³å®šç±»å†…æ•°æ®çš„åˆ†å¸ƒç‰¹æ€§ã€‚

## APIæ–‡æ¡£

### EmbeddingGeneratorç±»

#### ä¸»è¦æ–¹æ³•

- `generate_clustered_embeddings()`: ç”Ÿæˆèšç±»embeddings
- `get_class_statistics()`: è·å–ç±»åˆ«ç»Ÿè®¡ä¿¡æ¯
- `reduce_dimensions()`: é™ç»´å¤„ç†
- `save_embeddings()`: ä¿å­˜æ•°æ®
- `load_embeddings()`: åŠ è½½æ•°æ®

#### ç»Ÿè®¡ä¿¡æ¯

ç”Ÿæˆçš„ç»Ÿè®¡ä¿¡æ¯åŒ…æ‹¬ï¼š
- å„ç±»åˆ«æ ·æœ¬æ•°é‡
- ç±»åˆ«ä¸­å¿ƒåæ ‡
- ç±»å†…æ ‡å‡†å·®
- ç±»å†…å¹³å‡è·ç¦»
- ç±»é—´è·ç¦»ç»Ÿè®¡ï¼ˆå‡å€¼ã€æœ€å°å€¼ã€æœ€å¤§å€¼ï¼‰

## åº”ç”¨åœºæ™¯

1. **ä¸»åŠ¨å­¦ä¹ ç ”ç©¶**: ä¸ºä¸»åŠ¨å­¦ä¹ ç®—æ³•æä¾›å¯æ§çš„æµ‹è¯•æ•°æ®
2. **èšç±»ç®—æ³•è¯„ä¼°**: ç”Ÿæˆå…·æœ‰å·²çŸ¥ç»“æ„çš„æ•°æ®ç”¨äºç®—æ³•éªŒè¯
3. **é™ç»´ç®—æ³•æµ‹è¯•**: æä¾›é«˜ç»´æ•°æ®ç”¨äºé™ç»´ç®—æ³•æ€§èƒ½è¯„ä¼°
4. **å¯è§†åŒ–ç³»ç»Ÿå¼€å‘**: ä¸º3Då¯è§†åŒ–ç³»ç»Ÿæä¾›æ•°æ®æº
5. **æœºå™¨å­¦ä¹ æ•™å­¦**: å¸®åŠ©ç†è§£é«˜ç»´æ•°æ®çš„å‡ ä½•ç‰¹æ€§

## ç‰¹æ€§æ›´æ–°

### v1.4.0 - Embeddingç»´åº¦è®¾ç½®åŠŸèƒ½
- âœ¨ æ–°å¢ï¼šæ”¯æŒ3-2048ç»´embeddingç”Ÿæˆ
- âœ¨ æ–°å¢ï¼š3ç»´æ•°æ®æ™ºèƒ½é™ç»´å¤„ç†
- âœ¨ æ–°å¢ï¼šWebç•Œé¢ç»´åº¦è®¾ç½®æ§ä»¶
- âœ¨ æ–°å¢ï¼šåŠ¨æ€ç»´åº¦å‚æ•°è¦†ç›–

### v1.3.0 - Webç•Œé¢å’Œç¼“å­˜ç³»ç»Ÿ
- âœ¨ æ–°å¢ï¼šç°ä»£åŒ–Webç•Œé¢
- âœ¨ æ–°å¢ï¼šHDF5æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ
- âœ¨ æ–°å¢ï¼šå®æ—¶3Då¯è§†åŒ–
- âœ¨ æ–°å¢ï¼šå‚æ•°èŒƒå›´æ‰©å±•å’Œæ ‡å‡†åŒ–

### v1.2.0 - é™ç»´å’Œå‚æ•°ç³»ç»Ÿ
- âœ¨ æ–°å¢ï¼št-SNEã€UMAPé™ç»´æ”¯æŒ
- âœ¨ æ–°å¢ï¼šæ¯ç±»åˆ«ç‹¬ç«‹å‚æ•°æ§åˆ¶
- âœ¨ æ–°å¢ï¼šå‚æ•°èŒƒå›´æ ‡å‡†åŒ–åˆ°0-1

## ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

- [ ] æ·»åŠ æ›´å¤šéçº¿æ€§å˜æ¢ç±»å‹
- [ ] æ·»åŠ å™ªå£°æ³¨å…¥åŠŸèƒ½
- [ ] æ·»åŠ ä¸»åŠ¨å­¦ä¹ æŸ¥è¯¢ç®—æ³•
- [ ] æ”¯æŒæ›´å¤šæ•°æ®å¯¼å‡ºæ ¼å¼
- [ ] æ·»åŠ æ‰¹é‡å®éªŒåŠŸèƒ½

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦æƒ…è¯·è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚
