# FPS (最远点采样) 功能使用说明

## 功能概述

FPS (Farthest Point Sampling) 是一种在高维空间中进行点采样的算法，通过迭代选择距离已选点最远的点来实现多样化采样。本系统实现了完整的FPS可视化功能，包括路径可视化和范围查看。

## 主要特性

### 1. 多种距离度量
- **欧氏距离 (Euclidean)**: 标准的L2范数距离
- **余弦距离 (Cosine)**: 基于向量夹角的距离度量
- **切比雪夫距离 (Chebyshev)**: 无穷范数距离
- **曼哈顿距离 (Manhattan)**: L1范数距离
- **闵可夫斯基距离 (Minkowski)**: 广义Lp范数距离

### 2. 交互式点选择
- 点击3D可视化中的任意点设置FPS起始点
- 实时显示选中点的索引
- 自动更新起始索引输入框

### 3. 路径可视化
- **亮青色渐变**: 选中的点和路径使用亮青色显示
- **亮度渐变**: 从起始点的100%亮度逐渐降至最后点的10%亮度
- **路径连线**: 显示FPS遍历的完整路径
- **原始点云**: 半透明显示所有原始数据点

### 4. 范围查看功能
- **子范围选择**: 可以选择FPS路径中的任意子范围进行查看
- **橙色标记**: 范围左侧的已选择点用橙色显示
- **增强显示**: 范围内的点更大更不透明，便于区分
- **统计更新**: 实时更新选中范围的统计信息

## 使用步骤

### 第一步：生成Embeddings
1. 设置类别数量和参数
2. 点击"Generate Embeddings"生成数据
3. 等待生成完成，FPS控制面板将自动显示

### 第二步：选择起始点
1. 在3D可视化图中点击任意一个点
2. 系统会自动设置该点的索引为起始点
3. 右上角会显示"Selected point index: X"的提示

### 第三步：配置FPS参数
1. **距离度量**: 选择合适的距离计算方式
2. **采样数量**: 设置要采样的点数（2-1000）
3. **起始索引**: 通过点击设置，也可手动输入

### 第四步：执行FPS采样
1. 点击"Start FPS Sampling"按钮
2. 等待算法执行完成
3. 查看更新后的3D可视化和统计信息

### 第五步：范围查看（可选）
1. 在"FPS Range View"面板中设置查看范围
2. **Range Start**: 范围起始索引（从0开始）
3. **Range End**: 范围结束索引
4. 点击"View Range"查看指定范围

## 可视化说明

### 颜色编码
- **原始点云**: 按类别使用不同颜色，半透明显示
- **FPS选中点**: 亮青色 (rgba(0, 255, 255, opacity))
- **FPS路径**: 亮青色连线，与点同步渐变
- **范围外点**: 橙色显示，表示已选但不在当前范围内
- **范围内点**: 亮青色渐变，更大更不透明

### 亮度渐变
- 起始点: 100%亮度 (opacity = 1.0)
- 中间点: 线性渐变
- 最后点: 10%亮度 (opacity = 0.1)
- 范围查看时最低亮度为50%以确保可见性

## 统计信息

### FPS统计
- **Selected Points**: 选中的总点数
- **Total Distance**: 路径总长度
- **Avg Step Distance**: 平均步长距离
- **Distance Metric**: 使用的距离度量方式
- **类别分布**: 各类别在选中点中的数量

### 范围统计
- 当使用范围查看时，统计信息会更新为范围内的数据
- 显示范围内各类别的点数分布
- 计算范围内路径的距离统计

## 技术实现

### 后端API
- `/api/fps/start`: 执行FPS采样
- `/api/fps/range`: 范围查看
- `/api/fps/metrics`: 获取可用距离度量

### 数据存储
- 使用HDF5格式存储FPS结果
- 包含选中索引、距离度量、统计信息
- 支持结果的持久化和重新加载

### 算法特点
- 时间复杂度: O(n²k)，其中n为总点数，k为采样数
- 空间复杂度: O(n)
- 支持高维数据的有效采样
- 保证采样点的多样性和代表性

## 使用建议

### 参数选择
1. **起始点**: 选择数据边界或特殊位置的点作为起始点
2. **采样数量**: 根据数据规模选择，通常为总数的5-20%
3. **距离度量**: 
   - 欧氏距离: 适用于大多数情况
   - 余弦距离: 适用于高维稀疏数据
   - 切比雪夫距离: 关注最大差异时使用

### 可视化技巧
1. 使用范围查看功能分段分析FPS路径
2. 观察类别分布了解采样的均衡性
3. 通过路径长度判断采样的多样性

### 性能优化
1. 对于大数据集，建议先降维再进行FPS
2. 采样数量不宜过大，避免计算时间过长
3. 可以多次运行不同起始点比较结果

## 故障排除

### 常见问题
1. **点击无响应**: 确保已生成embeddings数据
2. **起始索引错误**: 重新点击选择或手动输入有效索引
3. **采样失败**: 检查参数范围和数据完整性
4. **可视化异常**: 刷新页面重新生成数据

### 错误信息
- "No embeddings generated yet": 需要先生成embeddings
- "Start index out of range": 起始索引超出数据范围
- "Number of samples exceeds total points": 采样数量过大
- "No FPS results found": 需要先执行FPS采样

## 扩展功能

系统支持进一步扩展：
1. 添加更多距离度量方式
2. 支持约束条件的FPS采样
3. 多起始点的并行FPS
4. FPS结果的导出和分析工具 